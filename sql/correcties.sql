BEGIN TRANSACTION;

UPDATE "WEGOBJECTEN" 
SET BEGINORGANISATIE = 1
WHERE AARDWEGOBJECT = 5 AND NOT( BEGINORGANISATIE= 1 OR BEGINORGANISATIE= 99) ;

UPDATE "SUBADRESSEN" 
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR BEGINORGANISATIE= 99) ;

UPDATE "SUBADRESSEN" 
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR BEGINORGANISATIE= 99) ;

UPDATE "huisnummers" 
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "subadresstatussen" 
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "STRAATKANTEN"
SET BEGINORGANISATIE = 1
WHERE 
NOT (STRAATKANTEN.BEGINORGANISATIE = 1 OR STRAATKANTEN.BEGINORGANISATIE = 99)
AND EXISTS
  (SELECT ID FROM WEGOBJECTEN
   WHERE STRAATKANTEN.WEGOBJECTID = WEGOBJECTEN.ID
   AND WEGOBJECTEN.AARDWEGOBJECT = 5  );
  
UPDATE "POSTKANTONCODES"
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "huisnummerstatussen"
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "adresposities"
SET BEGINORGANISATIE = 5
WHERE  herkomstadrespositie >= 10 AND
 NOT( BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "ADRES_RRADRES_RELATIES"
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "ADRES_RRADRES_RELATIES"
SET BEGINORGANISATIE = 1
WHERE  NOT( BEGINORGANISATIE= 1 OR  BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

UPDATE "ADRES_KADADRES_RELATIES"
SET BEGINORGANISATIE = 5
WHERE  NOT( BEGINORGANISATIE= 5 OR BEGINORGANISATIE= 99) ;

-- TODO: geldigheid periode 
/* CONTROLE:
SELECT ID, begindatum, eindtijd FROM ADRES_RRADRES_RELATIES t1
        WHERE EXISTS(
            SELECT NULL FROM ADRES_RRADRES_RELATIES t2 WHERE 
            t2.ID <> t1.ID 
            AND t2.rradresid = t1.rradresid
            AND t2.adresid = t1.adresid
            AND t2.aardadres = t1.aardadres
            AND t2.begindatum < t1.begindatum
    )
ORDER BY begindatum
        
        */
UPDATE ADRES_RRADRES_RELATIES 
SET EINDDATUM =  date( begindatum,'+1 day'), EINDTIJD = date('now') , EINDORGANISATIE = 1
WHERE EXISTS(
    SELECT NULL FROM ADRES_RRADRES_RELATIES t2 WHERE 
    t2.ID <> ADRES_RRADRES_RELATIES.ID 
    AND t2.rradresid = ADRES_RRADRES_RELATIES.rradresid
    AND t2.adresid = ADRES_RRADRES_RELATIES.adresid
    AND t2.aardadres = ADRES_RRADRES_RELATIES.aardadres
    AND t2.begindatum > ADRES_RRADRES_RELATIES.begindatum
    );
   
   
   
   
COMMIT;

